# Database Migrations

This directory contains database migrations for the fintech application using Alembic.

## Migration Commands

### Create a New Migration
```bash
alembic revision --autogenerate -m "description_of_changes"
```

### Apply Migrations
```bash
# Apply all pending migrations
alembic upgrade head

# Apply specific number of migrations
alembic upgrade +n

# Rollback specific number of migrations
alembic downgrade -n

# Rollback all migrations
alembic downgrade base
```

### Migration Status
```bash
# View current migration status
alembic current

# View migration history
alembic history --verbose
```

## Best Practices

1. **Always Review Autogenerated Migrations**
   - Alembic may not detect all changes
   - Verify the migration logic is correct
   - Add necessary data migrations

2. **Test Migrations**
   - Test both upgrade and downgrade paths
   - Use a staging database for testing
   - Verify data integrity after migration

3. **Security Considerations**
   - Never commit sensitive data in migrations
   - Use environment variables for credentials
   - Follow least privilege principle

4. **CI/CD Integration**
   - Run migrations as part of deployment
   - Include migration checks in CI pipeline
   - Maintain backup before running migrations

5. **Documentation**
   - Document complex migrations
   - Include reason for changes
   - Note any manual steps required

## Directory Structure

```
alembic/
├── versions/          # Migration version files
├── env.py            # Migration environment configuration
├── script.py.mako    # Migration file template
└── README.md         # This documentation
```

## Troubleshooting

1. **Migration Conflicts**
   - Ensure all developers pull latest migrations
   - Resolve conflicts in version chain
   - Consider squashing migrations if needed

2. **Failed Migrations**
   - Check transaction isolation level
   - Verify database permissions
   - Review migration logs

3. **Performance Issues**
   - Use batching for large data migrations
   - Consider maintenance window timing
   - Monitor database resources 